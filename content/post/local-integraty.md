+++
date = "2013-01-03T08:35:27+08:00"
draft = true
title = "local integraty"

+++



## 简介

什么是局部整体化呢？简单来说，就是把组成大部件的零件也当成大部件来看待，这样的话，一个大部件实际上就是由很多大部件（逻辑上是小零件）来构建而成的。听起来是挺怪的，至于为什么要这样做呢，请看下文。

## 起源

当时我们在做Android平台上的陀螺游戏，通过计算顶点坐标构建出陀螺的3D模型（即圆锥+圆柱+圆），后来突然在纹理贴图的设计上卡住了。因为每个顶点坐标数组只能用一幅纹理，当我们将圆锥、圆柱和圆的顶点坐标都放在一起时，要么就只能用同一幅纹理贴图，要么就只能分开成3个类来写。只用同一幅纹理贴图显然是无法达到我们的要求的，因为这样根本无法控制陀螺的外观，可把它拆成3份又有很多数据是共享的，例如圆锥半径跟圆柱半径就是一样的，而且它们的旋转行为都是要保持一致的。最后我们还是选择了分别写3个不同的类，再用一个陀螺类将3者结合在一起，而在我进行代码拷贝的时候，发现其实只要修改一下顶点坐标的生成这一小部分的代码，也可以达到和原来作为整体时一样的效果。什么意思呢？就是说现在的圆锥类、圆柱类还有圆类都分别有一整套陀螺的数据成员和成员函数（它们各有一个半径的属性，但是半径的值是相等的），这样的话三者虽然独立成不同的对象，却因为有一模一样的属性从而保证了它们行为的一致性。

## 应用

至于这个可以应用到怎样的程序设计当中呢？当一个整体是由多个独立的零部件组成时，而零部件之间的行为又要保持一致的话，或者所有零部件都要共享整体的属性时都可以用到。在这里陀螺模型就是一个很好的例子，因为组成陀螺的圆锥、圆柱和圆都是共享同一个半径的，而且三者的自转角速度和平移速度都要严格一致，所以这时我们可以将每一个小部件都作为一个整体来看待。

## 缺陷

这种设计模式的缺陷其实也很明显，就是代码冗余，因为每一个小部件不可能都用到整体的所有属性（例如陀螺里面圆柱类就不需要知道圆锥的高度），但是由于代码都是Ctrl+C、Ctrl+V来完成的，所以对于编码的复杂度也没有提高。

## 总结

这样的设计思想是我在编码时遇到问题才想到的，没有经过任何的数学证明或者逻辑分析，如果大家觉得有什么问题的话，希望能够留下您的评价。

![](/images/local-integraty.jpg)